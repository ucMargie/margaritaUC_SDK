"use strict";var __read=this&&this.__read||function(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var a,e,t=m.call(o),i=[];try{for(;(void 0===n||n-- >0)&&!(a=t.next()).done;)i.push(a.value)}catch(o){e={error:o}}finally{try{a&&!a.done&&(m=t.return)&&m.call(t)}finally{if(e)throw e.error}}return i},__spread=this&&this.__spread||function(){for(var o=[],n=0;n<arguments.length;n++)o=o.concat(__read(arguments[n]));return o};Object.defineProperty(exports,"__esModule",{value:!0});var command_1=require("./command"),CommandMap_1=require("./command/CommandMap"),CmpApiModel_1=require("./CmpApiModel"),Disabled_1=require("./response/Disabled"),SupportedVersions_1=require("./SupportedVersions");exports.API_KEY="__tcfapi";var CallResponder=function(){function o(o){var n,m,a;if(o){var e=command_1.TCFCommand.ADD_EVENT_LISTENER;if(null===(n=o)||void 0===n?void 0:n[e])throw new Error("Built-In Custom Commmand for "+e+" not allowed: Use "+command_1.TCFCommand.GET_TC_DATA+" instead");if(e=command_1.TCFCommand.REMOVE_EVENT_LISTENER,null===(m=o)||void 0===m?void 0:m[e])throw new Error("Built-In Custom Commmand for "+e+" not allowed");(null===(a=o)||void 0===a?void 0:a[command_1.TCFCommand.GET_TC_DATA])&&(o[command_1.TCFCommand.ADD_EVENT_LISTENER]=o[command_1.TCFCommand.GET_TC_DATA],o[command_1.TCFCommand.REMOVE_EVENT_LISTENER]=o[command_1.TCFCommand.GET_TC_DATA]),this.customCommands=o}try{this.callQueue=window[exports.API_KEY]()||[]}catch(o){this.callQueue=[]}finally{window[exports.API_KEY]=this.apiCall.bind(this),this.purgeQueuedCalls()}}return o.prototype.apiCall=function(o,n,m){for(var a,e=[],t=3;t<arguments.length;t++)e[t-3]=arguments[t];if("string"!=typeof o)m(null,!1);else if(SupportedVersions_1.SupportedVersions.has(n)){if("function"!=typeof m)throw new Error("invalid callback function");CmpApiModel_1.CmpApiModel.disabled?m(new Disabled_1.Disabled,!1):this.isCustomCommand(o)||this.isBuiltInCommand(o)?this.isCustomCommand(o)&&!this.isBuiltInCommand(o)?(a=this.customCommands)[o].apply(a,__spread([m],e)):o===command_1.TCFCommand.PING?this.isCustomCommand(o)?new CommandMap_1.CommandMap[o](this.customCommands[o],e[0],null,m):new CommandMap_1.CommandMap[o](m,e[0]):void 0===CmpApiModel_1.CmpApiModel.tcModel?this.callQueue.push(__spread([o,n,m],e)):this.isCustomCommand(o)&&this.isBuiltInCommand(o)?new CommandMap_1.CommandMap[o](this.customCommands[o],e[0],null,m):new CommandMap_1.CommandMap[o](m,e[0]):m(null,!1)}else m(null,!1)},o.prototype.purgeQueuedCalls=function(){var o=this.callQueue;this.callQueue=[],o.forEach((function(o){window[exports.API_KEY].apply(window,__spread(o))}))},o.prototype.isCustomCommand=function(o){return this.customCommands&&"function"==typeof this.customCommands[o]},o.prototype.isBuiltInCommand=function(o){return void 0!==CommandMap_1.CommandMap[o]},o}();exports.CallResponder=CallResponder;