"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Base64Url_1=require("./Base64Url"),BitLength_1=require("./BitLength"),field_1=require("./field"),sequence_1=require("./sequence"),errors_1=require("../errors"),Fields_1=require("../model/Fields"),model_1=require("../model"),SegmentEncoder=function(){function e(){}return e.encode=function(e,r){var n,i=this;try{n=this.fieldSequence[""+e.version][r]}catch(n){throw new errors_1.EncodingError("Unable to encode version: "+e.version+", segment: "+r)}var t="";return r!==model_1.Segment.CORE&&(t=field_1.IntEncoder.encode(model_1.SegmentIDs.KEY_TO_ID[r],BitLength_1.BitLength.segmentType)),n.forEach((function(n){var o=e[n],s=field_1.FieldEncoderMap[n],d=BitLength_1.BitLength[n];void 0===d&&i.isPublisherCustom(n)&&(d=+e[Fields_1.Fields.numCustomPurposes]);try{t+=s.encode(o,d)}catch(e){throw new errors_1.EncodingError("Error encoding "+r+"->"+n+": "+e.message)}})),Base64Url_1.Base64Url.encode(t)},e.decode=function(e,r,n){var i=this,t=Base64Url_1.Base64Url.decode(e),o=0;return n===model_1.Segment.CORE&&(r.version=field_1.IntEncoder.decode(t.substr(o,BitLength_1.BitLength[Fields_1.Fields.version]),BitLength_1.BitLength[Fields_1.Fields.version])),n!==model_1.Segment.CORE&&(o+=BitLength_1.BitLength.segmentType),this.fieldSequence[""+r.version][n].forEach((function(e){var n=field_1.FieldEncoderMap[e],s=BitLength_1.BitLength[e];if(void 0===s&&i.isPublisherCustom(e)&&(s=+r[Fields_1.Fields.numCustomPurposes]),0!==s){var d=t.substr(o,s);if(n===field_1.VendorVectorEncoder?r[e]=n.decode(d,r.version):r[e]=n.decode(d,s),Number.isInteger(s))o+=s;else{if(!Number.isInteger(r[e].bitLength))throw new errors_1.DecodingError(e);o+=r[e].bitLength}}})),r},e.isPublisherCustom=function(e){return 0===e.indexOf("publisherCustom")},e.fieldSequence=new sequence_1.FieldSequence,e}();exports.SegmentEncoder=SegmentEncoder;