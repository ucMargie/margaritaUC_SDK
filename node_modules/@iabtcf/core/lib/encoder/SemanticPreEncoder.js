"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var errors_1=require("../errors"),model_1=require("../model"),SemanticPreEncoder=function(){function e(){}return e.process=function(e,r){var o,s,n=e.gvl;if(!n)throw new errors_1.EncodingError("Unable to encode TCModel without a GVL");if(!n.isReady)throw new errors_1.EncodingError("Unable to encode TCModel tcModel.gvl.readyPromise is not resolved");(e=e.clone()).consentLanguage=n.language.toUpperCase(),(null===(o=r)||void 0===o?void 0:o.version)>0&&(null===(s=r)||void 0===s?void 0:s.version)<=this.processor.length?e.version=r.version:e.version=this.processor.length;var t=e.version-1;if(!this.processor[t])throw new errors_1.EncodingError("Invalid version: "+e.version);return this.processor[t](e,n)},e.processor=[function(e){return e},function(e,r){e.publisherRestrictions.gvl=r,e.purposeLegitimateInterests.unset(1);var o=new Map;return o.set("legIntPurposes",e.vendorLegitimateInterests),o.set("purposes",e.vendorConsents),o.forEach((function(o,s){o.forEach((function(n,t){if(n){var i=r.vendors[t];if(!i||i.deletedDate)o.unset(t);else if(0===i[s].length)if("legIntPurposes"===s&&0===i.purposes.length&&0===i.legIntPurposes.length&&i.specialPurposes.length>0);else if(e.isServiceSpecific)if(0===i.flexiblePurposes.length)o.unset(t);else{for(var l=e.publisherRestrictions.getRestrictions(t),c=!1,u=0,p=l.length;u<p&&!c;u++)c=l[u].restrictionType===model_1.RestrictionType.REQUIRE_CONSENT&&"purposes"===s||l[u].restrictionType===model_1.RestrictionType.REQUIRE_LI&&"legIntPurposes"===s;c||o.unset(t)}else o.unset(t)}}))})),e.vendorsDisclosed.set(r.vendors),e}],e}();exports.SemanticPreEncoder=SemanticPreEncoder;